# 强制 HTTPS 重定向
http://${MASTER_DOMAIN} {
    redir https://${MASTER_DOMAIN}{uri} permanent
}

https://${MASTER_DOMAIN} {
    # HSTS 头
    header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # 其他安全头
    header X-Content-Type-Options "nosniff"
    header X-Frame-Options "DENY"
    header X-XSS-Protection "1; mode=block"
    header Referrer-Policy "strict-origin-when-cross-origin"
    
    # 基本认证
    basicauth {
        ${ADMIN_USER} ${ADMIN_PASSWORD_HASH}
    }
    
    reverse_proxy web:8080
}