# SSL 证书问题 - 用户指南

## 🔒 为什么浏览器显示"不安全"？

安装完成后，浏览器可能显示：
- Chrome: "您的连接不是私密连接"
- Firefox: "警告：潜在的安全风险"  
- Safari: "此连接不是私密连接"
- Edge: "您的连接不是专用连接"

**这是正常的！** 因为系统使用的是自签名证书。

## ✅ 三种解决方案

### 方案 1️⃣：直接访问（最简单）

**适合**：快速测试、个人使用

**步骤**：
1. 看到浏览器警告时，点击「高级」或「详细信息」
2. 点击「继续访问」或「接受风险并继续」
3. 完成！现在可以正常使用了

**说明**：
- ✅ 数据仍然是加密的
- ✅ 完全安全（因为是你自己的服务器）
- ⚠️ 浏览器会显示"不安全"标记（可以忽略）

---

### 方案 2️⃣：获取正式证书（推荐）

**适合**：生产环境、公开服务

**前提条件**：
- ✅ 域名已解析到服务器 IP
- ✅ 端口 80 可以从公网访问
- ✅ 服务器可以连接互联网

**步骤**：
```bash
# 1. 连接到服务器
ssh root@你的服务器IP

# 2. 运行证书获取脚本（会自动处理所有步骤）
cd /opt/xray-cluster/node
bash get-certs.sh

# 脚本会自动：
# - 检查并安装依赖（curl, socat, cron）
# - 停止 Xray 释放 80 端口
# - 获取 Let's Encrypt 证书
# - 安装证书
# - 重启 Xray 服务

# 3. 刷新浏览器，警告消失！
```

**说明**：
- ✅ 浏览器完全信任
- ✅ 免费
- ✅ 自动续期（90天）
- ✅ 适合长期使用

---

### 方案 3️⃣：重新安装（如果证书损坏）

**适合**：证书文件损坏或为空

**检查是否需要**：
```bash
# 查看证书文件大小
ls -lh /opt/xray-cluster/node/certs/

# 如果显示 0 字节，说明需要重新安装
```

**步骤**：
```bash
# 重新运行安装脚本（会保留你的配置）
curl -fsSL https://raw.githubusercontent.com/hioTEC/XUI-SOLO/main/install.sh | \
    sudo bash -s -- --solo --panel 你的面板域名 --node-domain 你的节点域名

# 安装时选择「保留现有配置」
```

---

## 📱 各浏览器操作指南

### Chrome / Edge

1. 看到"您的连接不是私密连接"
2. 点击「高级」
3. 点击「继续前往 xxx（不安全）」
4. 完成！

### Firefox

1. 看到"警告：潜在的安全风险"
2. 点击「高级」
3. 点击「接受风险并继续」
4. 完成！

### Safari

1. 看到"此连接不是私密连接"
2. 点击「显示详细信息」
3. 点击「访问此网站」
4. 输入 macOS 密码确认
5. 完成！

---

## 🤔 常见问题

### Q: 自签名证书安全吗？

**A**: 是的！自签名证书提供：
- ✅ 加密传输（数据不会被窃听）
- ✅ 防止中间人攻击
- ⚠️ 只是浏览器无法验证服务器身份

对于自己的服务器，这完全安全。

### Q: 为什么不默认使用正式证书？

**A**: 因为正式证书需要：
1. 域名已经解析（可能还在传播中）
2. 端口 80 可访问（可能被防火墙阻止）
3. 网络连接正常（可能在内网环境）

自签名证书确保安装后立即可用，你可以稍后升级到正式证书。

### Q: 如何知道证书是否正常？

**A**: 运行以下命令：
```bash
# 1. 检查证书文件
ls -lh /opt/xray-cluster/node/certs/

# 应该看到文件大小 > 0，例如：
# -rw-r--r-- 1 root root 1.3K Dec  6 10:00 panel.example.com.crt
# -rw------- 1 root root 1.7K Dec  6 10:00 panel.example.com.key

# 2. 测试 HTTPS 连接
curl -Ik https://你的面板域名

# 应该返回 HTTP 状态码（如 200, 301 等）
```

### Q: 证书会过期吗？

**A**: 
- **自签名证书**：365 天后过期，需要重新生成
- **Let's Encrypt 证书**：90 天后过期，但会自动续期

### Q: 可以使用自己的证书吗？

**A**: 可以！步骤：
```bash
# 1. 上传你的证书文件到服务器
scp your-cert.crt root@服务器IP:/opt/xray-cluster/node/certs/你的域名.crt
scp your-cert.key root@服务器IP:/opt/xray-cluster/node/certs/你的域名.key

# 2. 设置权限
chmod 644 /opt/xray-cluster/node/certs/你的域名.crt
chmod 600 /opt/xray-cluster/node/certs/你的域名.key

# 3. 重启 Xray
cd /opt/xray-cluster/node
docker-compose restart xray
```

---

## 🎯 推荐流程

### 新用户（第一次安装）

1. **运行安装脚本** → 自动生成自签名证书
2. **访问面板** → 接受浏览器警告（方案1）
3. **配置系统** → 添加节点、用户等
4. **获取正式证书** → 运行 `get-certs.sh`（方案2）
5. **刷新浏览器** → 警告消失，正常使用

### 已安装用户（遇到证书问题）

1. **检查证书** → `ls -lh /opt/xray-cluster/node/certs/`
2. **如果为空** → 重新安装（方案3）或手动生成
3. **如果正常** → 直接访问（方案1）或获取正式证书（方案2）

---

## 📞 需要帮助？

### 查看详细文档

- **快速参考**：`QUICK_FIX_SSL.md`
- **故障排查**：`TROUBLESHOOTING.md`
- **技术细节**：`SSL_CERTIFICATE_FIX.md`

### 检查服务状态

```bash
# 查看所有容器状态
cd /opt/xray-cluster/node
docker-compose ps

# 查看 Xray 日志
docker-compose logs xray

# 查看端口监听
netstat -tlnp | grep :443
```

### 提交问题

如果问题仍未解决，请访问：
https://github.com/hioTEC/XUI-SOLO/issues

提交 Issue 时请包含：
- 操作系统版本
- 错误信息截图
- 相关日志

---

## 💡 小贴士

1. **测试环境**：使用方案1（接受警告）最快
2. **生产环境**：使用方案2（正式证书）最好
3. **内网环境**：只能使用方案1（无法获取正式证书）
4. **证书续期**：Let's Encrypt 证书会自动续期，无需操作

---

## ✨ 总结

- 浏览器警告是正常的（使用自签名证书）
- 三种方案任选其一
- 推荐：先用方案1快速访问，再用方案2获取正式证书
- 数据始终是加密的，完全安全

**祝使用愉快！** 🎉
